(window["webpackJsonproad-traffic"]=window["webpackJsonproad-traffic"]||[]).push([[0],{286:function(e,t,a){e.exports=a(613)},612:function(e){e.exports=JSON.parse('{"cors_proxy":"https://cors-anywhere.herokuapp.com/","api":"https://roadtraffic.dft.gov.uk/api/"}')},613:function(e,t,a){"use strict";a.r(t);a(287),a(296);var n=a(0),o=a.n(n),r=a(17),i=a.n(r),l=a(61),c=a(62),s=a(67),u=a(63),d=a(68),h=a(676),p=a(674),m=a(273),_=a.n(m),f=a(274),g=a.n(f),y=a(275),b=a(675),v=a(6),E=a(267),w=a.n(E),j=a(664),x=a(657),O=a(663),k=a(660),C=a(659),A=a(661),S=a(617),D=a(662),B=a(671),F=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a.close=function(){a.props.close()},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.width,r=t.traffic_point,i=Object(B.b)("sm",n);return o.a.createElement(x.a,{fullScreen:i,disableBackdropClick:!0,open:this.props.open,onClose:this.close,"aria-labelledby":"responsive-dialog-title",BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:a.dialog}},o.a.createElement(C.a,{id:"responsive-dialog-title"},"Details"),o.a.createElement(k.a,null,o.a.createElement(A.a,{className:a.root},o.a.createElement(S.a,null,o.a.createElement(D.a,{primary:"Road type",secondary:r.road_type})),o.a.createElement(S.a,null,o.a.createElement(D.a,{primary:"Road name",secondary:r.road_name})))),o.a.createElement(O.a,null,o.a.createElement(j.a,{onClick:function(){return e.close()},color:"secondary"},"Close")))}}]),t}(o.a.Component),N=w()(Object(B.a)(),Object(v.a)((function(e){return{dialog:{border:"1px solid #e5e5e5"},list:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper}}}),{withTheme:!0}))(F),P=a(110),M=a(666),R=a(271),z=a(667),T=a(673),W=a(672),Y=a(665),Z=a(668),I=a(670),J=a(269),L=Object(v.a)((function(e){return{root:{"label + &":{marginTop:e.spacing(3)}},input:{borderRadius:4,position:"relative",backgroundColor:e.palette.background.paper,border:"1px solid #ced4da",fontSize:16,padding:"10px 26px 10px 12px",transition:e.transitions.create(["border-color","box-shadow"]),fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(","),"&:focus":{borderRadius:4,borderColor:"#80bdff",boxShadow:"0 0 0 0.2rem rgba(0,123,255,.25)"}}}}))(T.a),U=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a.componentDidMount=function(){a.setState({})},a.openDetails=function(){return a.setState({info_dialog_open:!0})},a.closeDetails=function(){return a.setState({info_dialog_open:!1})},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.selected_year,r=t.selected_authority,i=t.changeYear,l=t.changeAuthority,c=t.traffic_points,s=t.theme,u=t.percentages,d={labels:["HGVs","Buses and coaches","Cars and taxis","Pedal cycles"],datasets:[{backgroundColor:Object(R.fade)(s.palette.primary.main,.6),data:[u.all_hgvs,u.buses_and_coaches,u.cars_and_taxis,u.pedal_cycles]}]};return o.a.createElement("div",null,o.a.createElement(P.a,{variant:"h5",component:"h5",gutterBottom:!0},"Traffic Data"),o.a.createElement(Y.a,null,"Filters: Annual Average Daily Flow By Direction"),o.a.createElement(M.a,null),o.a.createElement("br",null),o.a.createElement(P.a,{variant:"body2"},"Choose a year to look at traffic flow data for that year."),o.a.createElement(z.a,{className:a.formControl},o.a.createElement(W.a,{htmlFor:"sel-year"},"Year"),o.a.createElement(I.a,{value:n,onChange:function(e){return i(e.target.value)},input:o.a.createElement(L,{name:"year",id:"sel-year"})},o.a.createElement(Z.a,{value:"2016"},"2016"),o.a.createElement(Z.a,{value:"2017"},"2017"),o.a.createElement(Z.a,{value:"2018"},"2018"))),o.a.createElement("br",null),o.a.createElement(M.a,null),o.a.createElement("br",null),o.a.createElement(P.a,{variant:"body2"},"Choose an authority to look at traffic flow data for that area."),o.a.createElement(z.a,{className:a.formControl},o.a.createElement(W.a,{htmlFor:"sel-authority"},"Authority"),o.a.createElement(I.a,{value:r,onChange:function(e){return l(e.target.value)},input:o.a.createElement(L,{name:"authority",id:"sel-authority"})},o.a.createElement(Z.a,{value:""},"Choose authority"),this.props.authorities.sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return o.a.createElement(Z.a,{key:e.id,value:e.id},e.name)})))),o.a.createElement("br",null),o.a.createElement(M.a,null),o.a.createElement("br",null),o.a.createElement(P.a,{variant:"body2"},"To do: add vehicle type and other filters"),o.a.createElement("br",null),o.a.createElement(j.a,{color:"primary",variant:"outlined",onClick:function(){return e.props.getAverageDailyFlow()}},"Refresh data"),o.a.createElement("br",null),c.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement(Y.a,null,"Charts: Annual Average Daily Flow By Direction"),o.a.createElement(M.a,null),o.a.createElement(J.a,{data:d,height:200,options:{maintainAspectRatio:!0,legend:{display:!1},scales:{xAxes:[{ticks:{beginAtZero:!0},scaleLabel:{display:!0,title:"Percentage"}}]}}})):null)}}]),t}(n.Component),G=Object(v.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}}),{withTheme:!0})(U),H=a(109),V=Object(H.d)({minZoom:5,maxZoom:18,scrollZoom:!0,interactive:!0,dragRotate:!0,attributionControl:!0}),$=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a.componentDidMount=function(){},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.position,a=e.zoom,n=e.pitch,r=e.bearing,i=e.fit_bounds,l=e.traffic_points,c=e.viewPoint;return o.a.createElement(V,{style:"style.json",center:t,zoom:a,maxZoom:17,pitch:n,bearing:r,fitBounds:i,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"}},o.a.createElement(H.b,{type:"circle",id:"traffic-points-layer",layout:{},paint:{"circle-radius":["/",["number",["get","all_motor_vehicles"],5e3],1e3],"circle-opacity":.5,"circle-color":"rgb(171, 72, 33)"}},l.map((function(e){return o.a.createElement(H.a,{key:e.count_point_id,coordinates:[e.longitude,e.latitude],properties:e,onClick:function(e){c(e)}})}))),o.a.createElement(H.c,{position:"bottom-right"}))}}]),t}(n.Component),q=a(179),K=a.n(q),Q=a(21),X=a(612);var ee=Object(y.a)({palette:{primary:_.a,secondary:g.a},overrides:{MuiButton:{text:{textTransform:"inherit"}}}}),te=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={info_dialog_open:!1,fit_bounds:null,position:[-2.1,53.6138],zoom:[7],pitch:[0],bearing:[0],distance:1609,current_position:[],authorities:[],selected_authority:"",selected_year:2018,traffic_points:[],traffic_point:{},percentages:{}},a.componentDidMount=function(){a.setState({}),a.getAuthorities()},a.openDetails=function(e){return a.setState({info_dialog_open:!0,traffic_point:e})},a.closeDetails=function(){return a.setState({info_dialog_open:!1})},a.changeYear=function(e){a.setState({selected_year:e})},a.changeAuthority=function(e){a.setState({selected_authority:e})},a.getAverageDailyFlow=function(){var e,t,n;""!==a.state.selected_year&&""!==a.state.selected_authority&&(e=a.state.selected_authority,t=a.state.selected_year,n=function(e){a.setState({traffic_points:e.data,fit_bounds:e.bounds,percentages:e.percentages})},K.a.get(X.cors_proxy+X.api+"average-annual-daily-flow-by-direction?filter[local_authority_id]="+e+"&filter[year]="+t).then((function(e){if(e&&e.data&&e.data.data){var t=[];e.data.data.forEach((function(e){t.push([e.longitude,e.latitude])}));var a=t.reduce((function(e,t){return e.extend(t)}),new Q.LngLatBounds(t[0],t[0])),o=a.getSouthWest(),r=a.getNorthEast(),i={all_hgvs:0,all_motor_vehicles:0,buses_and_coaches:0,cars_and_taxis:0,pedal_cycles:0,two_wheeled_motor_vehicles:0};e.data.data.forEach((function(e){i.all_hgvs=i.all_hgvs+e.all_hgvs,i.all_motor_vehicles=i.all_motor_vehicles+e.all_motor_vehicles,i.buses_and_coaches=i.buses_and_coaches+e.buses_and_coaches,i.cars_and_taxis=i.cars_and_taxis+e.cars_and_taxis,i.pedal_cycles=i.pedal_cycles+e.pedal_cycles,i.two_wheeled_motor_vehicles=i.two_wheeled_motor_vehicles+e.two_wheeled_motor_vehicles}));var l={all_hgvs:Math.round(i.all_hgvs/(i.all_motor_vehicles+i.pedal_cycles)*100),buses_and_coaches:Math.round(i.buses_and_coaches/(i.all_motor_vehicles+i.pedal_cycles)*100),cars_and_taxis:Math.round(i.cars_and_taxis/(i.all_motor_vehicles+i.pedal_cycles)*100),pedal_cycles:Math.round(i.pedal_cycles/(i.all_motor_vehicles+i.pedal_cycles)*100),two_wheeled_motor_vehicles:Math.round(i.two_wheeled_motor_vehicles/(i.all_motor_vehicles+i.pedal_cycles)*100)};n({data:e.data.data,bounds:[[o.lng,o.lat],[r.lng,r.lat]],percentages:l})}else n({data:[],bounds:void 0,percentages:{}})})).catch((function(e){n({data:[],bounds:void 0,percentages:{}})})))},a.viewPoint=function(e){a.openDetails(e.feature.properties)},a.getAuthorities=function(){var e;e=function(e){e.length>0&&a.setState({authorities:e})},K.a.get(X.cors_proxy+(X.api+"local-authorities"),{headers:{origin:"localhost"}}).then((function(t){t&&t.data&&t.data.data?e(t.data.data):e([])})).catch((function(t){e([])}))},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return o.a.createElement(b.a,{theme:ee},o.a.createElement("div",{className:t.root},o.a.createElement(h.a,null),o.a.createElement("nav",{className:t.drawer,"aria-label":"mailbox folders"},o.a.createElement(p.a,{classes:{paper:t.drawerPaper},variant:"permanent",open:!0},o.a.createElement(G,{authorities:this.state.authorities,selected_authority:this.state.selected_authority,selected_year:this.state.selected_year,getAverageDailyFlow:this.getAverageDailyFlow,changeYear:this.changeYear,changeAuthority:this.changeAuthority,traffic_points:this.state.traffic_points,percentages:this.state.percentages}))),o.a.createElement("main",{className:t.content},o.a.createElement("div",{className:t.toolbar}),o.a.createElement($,{bearing:this.state.bearing,fit_bounds:this.state.fit_bounds,pitch:this.state.pitch,position:this.state.position,current_position:this.state.current_position,zoom:this.state.zoom,traffic_points:this.state.traffic_points,viewPoint:this.viewPoint})),o.a.createElement(N,{open:this.state.info_dialog_open,close:function(){return e.closeDetails()}})))}}]),t}(n.Component),ae=Object(v.a)((function(e){return{root:{display:"flex"},content:{flexGrow:1,padding:e.spacing(3)},drawerPaper:{width:400,padding:15}}}))(te);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(ae,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[286,1,2]]]);
//# sourceMappingURL=main.e4832dd8.chunk.js.map